@page "/AdminLogin"
@rendermode InteractiveServer
@inject MyCustomAuthStateProvider MyAuthProvider
@inject NavigationManager MyNavMgr

<PageTitle>AdminLogin</PageTitle>

<h1>AdminLogin</h1>

<div class="login-container">

    @if (!string.IsNullOrEmpty(message))
    {
        <p style="color: red">@message</p>
    }

    <div class="input-group">
        <label>Benutzername</label>
        <input @bind="username" placeholder="Benutzername" />
    </div>

    <div class="input-group">
        <label>Passwort</label>
        <input @bind="password" placeholder="Passwort" type="password" />
    </div>

    <button @onclick="HandleLogin">
        Login
    </button>

</div>

@code {
    private string username = "";
    private string password = "";
    private string message = "";

    private async Task HandleLogin()
    {
        if (await IsValidUserAsync(username, password))
        {
            MyAuthProvider.Login(username);
            await Task.Delay(50);
            MyNavMgr.NavigateTo("/Admin", true);
        }
        else
        {
            message = "Login fehlgeschlagen.";
        }
    }

    private async Task<bool> IsValidUserAsync(string username, string password)
    {
        return await Db.Admins.AnyAsync(a =>
            a.Email == username && a.Password == password);
    }
}